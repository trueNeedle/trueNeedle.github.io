<html>
<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
    <style>
        @font-face {
            font-family: "title";
            src: url("./font/ChildFunSans-Demo.ttf");
        }

        @font-face {
            font-family: "info";
            src: url("./font/AlibabaHealthFont2.0CN-45R.ttf");
        }

        @font-face {
            font-family: "pixel";
            src: url("./font/DottedSongtiSquareRegular.ttf");
        }

        .ddddddddddd { /*2.梯形*/
            width: 300px; /*2.上底长度(为0即三角形)*/
            height: 0px;
            /*border-top:0px solid transparent;*/
            border-bottom: 50px solid blue; /*2.高度*/
            border-left: 100px solid transparent; /*2.左斜边x轴长度*/
            border-right: 100px solid transparent; /*2.右斜边x轴长度*/
        }

        .lbg1 {
            margin-top: 10px;
            width: 130px;
            border-bottom: 30px solid deepskyblue;
            border-right: 8px solid transparent;
        }

        .lbg2 {
            position: absolute;
            margin: 0;
            width: 130px;
            text-align: center;
        }
        .lbg3 {
            margin-top: 10px;
            width: 230px;
            border-bottom: 40px solid red;
            border-left: 12px solid transparent;
            transform: rotateZ(180deg);
        }

        .lbg4 {
            margin:0;
            width:240px;
            position: absolute;
            font-size: 30px;
            font-weight: 600;
            color: white;
            transform:rotateZ(180deg);
            text-align:center;
        }

        .deskBG {
            width: 600px;
            height: 500px;
            background-color: #1e1e1e;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%,-50%);
        }

        .roundRstTb { /*1.横向排列表格*/
            position: relative; /*1*/
            display: block; /*1*/
            text-align: center;
            font-size: 20px;
        }

            .roundRstTb tbody tr {
                display: inline-block; /*1*/
            }

            .roundRstTb tr td {
                display: block; /*1*/
                height: 30px;
                width: 50px;
            }


        p {
            word-break: break-all;
            word-wrap: break-word; /*自动换行*/
        }

        .slt {
            text-align: center;
            color: white;
            margin: 10px 0;
            font-size: 40px;
        }

        .rules {
            /*text-indent:2em;首行缩进*/
            margin: 10px 100px;
            color: white;
        }

        .rulesHead {
            color: gold;
            margin: 20px 40px;
        }

        button {
            font-weight: 600;
            font-size: 15px;
            background-color: pink;
            border-radius: 10px;
            padding: 5px;
            min-height: 40px;
            min-width: 70px;
        }
        .choseBut {
            border: royalblue 3px solid;
            background-color: deepskyblue;
            color:mediumblue;
        }

        #butBuy1, #butBuy2, #butBuy3, #butBuy4, #butBuy5 {
            background-color: gold;
            color: blue;
        }

        .newsDiv {
            background-color: #66ccff;
            height: 100px;
            width: 400px;
        }

        table {
            border-collapse: collapse;
            text-align: center;
        }

        #infoTb {
            font-size: 20px;
            font-weight: 600;
            border: deepskyblue;
            color: deepskyblue;
            position: absolute;
            left: 50%;
            top: 0;
            transform: translate(-50%,20px);
        }

        #shopTb {
            font-size: 20px;
            background-color: #1e1e1e;
            border-color: gold;
            color: white;
        }

        #shopD {
            position: absolute;
            left: 100%;
            transform: translate(-100%,0);
        }

        #desText {
            width: 160px;
            background-color: #1e1e1e;
            color: white;
            position: relative;
            font-size: 20px;
        }

        #alertArea {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 100%;
        }

        .altGround {
            position: absolute;
            left: 50%;
            top: 0;
            transform: translate(-50%,0);
            background-color: #1e1e1e;
            width: 400px;
            height: 150px;
            text-align: center;
            border: 8px white solid;
        }

        #naDivg {
            height: 700px;
            width: 1400px;
            background-color: orange;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%,-50%);
        }

        #mainFrame {
            width: 100%;
            height: 100%;
            background-color: #1e1e1e;
        }

        .newsCaution {
            font-size: 20px;
            background-color: red;
            border-radius: 15px;
            padding-left: 5px;
            padding-right: 5px;
            margin: 10px;
        }

        .infoBG {
            height: 500px;
            width: 650px;
            border: 8px purple solid;
            background-color: #1e1e1e;
            position: absolute;
            left: 50%;
            top: 0;
            transform: translate(-50%,0);
            font-family: info;
        }

        .mainBG {
            height: 640px;
            width: 1280px;
            background-color: #1e1e1e;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%,-50%);
            overflow-y: auto;
            scrollbar-width: none; /* Firefox 隐藏滚动条*/
            -ms-overflow-style: none; /* IE 10+ 隐藏滚动条*/
        }
            .mainBG::-webkit-scrollbar {
                display: none; /* Chrome Safari 隐藏滚动条*/
            }
        #caution { /*图片后不换行*/
            float: left;
            display: inline-block;
            width: 20px;
            height: 20px;
        }

        .rulBut {
            position: absolute;
            left: 100%;
            top: 0;
            transform: translate(-100%,0);
            border-radius: 0;
        }
        /*渐变消失动画*/
        .disappear {
            animation: dis 2s linear 1 forwards;
            -webkit-animation: dis 2s linear 1 forwards;
            animation-play-state: paused;
            -webkit-animation-play-state: paused;
        }

        @keyframes dis {
            0% {
                display: inherit
            }

            50% {
                opacity: 1
            }

            100% {
                opacity: 0;
                display: none
            }
        }

        @-webkit-keyframes dis {
            0% {
                display: inherit
            }

            50% {
                opacity: 1
            }

            100% {
                opacity: 0;
                display: none
            }
        }

        .gray { /*变灰动画*/
            animation: aniGray 0.2s linear 1 forwards;
            -webkit-animation: aniGray 0.2s linear 1 forwards;
            animation-play-state: paused;
            -webkit-animation-play-state: paused;
        }

        @-webkit-keyframes aniGray {
            0% {
                filter: none blur(0);
            }

            100% {
                filter: grayscale(100%) blur(1px);
            }
        }

        @keyframes aniGray {
            0% {
                filter: none blur(0);
            }

            100% {
                filter: grayscale(100%) blur(1px);
            }
        }
    </style>
</head>
<body id="bd" onload="onload()" style="cursor:default" onselectstart="return false;"ondragstart="return false;"><!--禁用选中和拖动网页元素-->

    <div id="mainFrame" class="gray">
        <!--主框架-->
        <div id="naDivg">
            <canvas id="naCanvas" width="1400" height="700"></canvas>
        </div>
        <div class="mainBG">
            <!--导航页面/主界面-->
            <div id="menuArea" style="text-align:center">
                <h1 style="font-size:80px;font-family:title">
                    <nobr style="color:red">石头?</nobr>
                    <nobr style="color:gold">剪刀?</nobr>
                    <nobr style="color:purple">布! </nobr>
                </h1>
                <div style="position:absolute;top:90%;left:50%;transform:translate(-50%,-100%);">
                    <p>
                        <nobr class="slt" id="select1" onmouseover="inSlt(1)" onmouseleave="outSlt(1)" onclick="sltClk1()">普通模式</nobr>
                    </p>
                    <p>
                        <nobr class="slt" id="select2" onmouseover="inSlt(2)" onmouseleave="outSlt(2)" onclick="sltClk2()">无尽模式</nobr>
                    </p>
                    <p>
                        <nobr class="slt" id="select3" onmouseover="inSlt(3)" onmouseleave="outSlt(3)" onclick="sltClk3()">游戏规则</nobr>
                    </p>
                    <p>
                        <nobr class="slt" id="select4" onmouseover="inSlt(4)" onmouseleave="outSlt(4)" onclick="showHis()">历史记录</nobr>
                    </p>
                </div>
            </div>
            <!--规则面板-->
            <div id="ruleArea" class="mainBG" style="display:none">
                <h2 class="rulesHead">基础规则</h2>
                <ul class="rules">
                    <li>本游戏判定规则为传统石头剪刀布规则，即按"石头>剪刀>布>石头"的克制顺序。</li>
                    <li>电脑会从三种手势中随机选择一种。</li>
                    <li>任意一方获胜10局将赢得整局胜利。</li>
                    <li>你拥有100初始金币，每回合需要交5金币手续费，结算时当金币数小于5（不包括）时，将立即结束游戏。</li>
                    <li>赢下回合会返还手续费并得到10金币，平局和失败不返还，且失败扣除10金币</li>
                </ul>
                <h2 class="rulesHead">连击</h2>
                <ul class="rules">
                    <li>获胜会增加连击数，到达一定数量会有额外奖励。</li>
                    <li>输掉会使连击数归零；平局不变但也不会有额外奖励。</li>
                    <li>连击数在等于3\4\5时，分别奖励10\20\30金币。</li>
                    <li>连击数大于等于6时，奖励50金币。</li>
                </ul>
                <h2 class="rulesHead">商店</h2>
                <ul class="rules">
                    <li>你可以在商店用金币购买道具，可以提供不同帮助。</li>
                    <li>通过点击商店右侧按钮来购买或取消购买，对局开始时将无法购买。</li>
                </ul>
                <h2 class="rulesHead">无尽模式</h2>
                <ul class="rules">
                    <li>不再有回合数限制。</li>
                    <li>初始金币200。</li>
                    <li>每回合只能在商店购买一种道具。</li>
                </ul>
                <button class="rulBut" onclick="rulesClkBack()">返回</button>
            </div>

            <div id="gameArea" style="background-color: #1e1e1e; display: none; width: 100%; height: 100%; overflow: hidden;">
                <!--游戏界面-->
                <div id="main" class="deskBG">
                    <div style="background-color:#252525;width: 400px; height: 120px; outline: 10px solid royalblue; border: 8px dotted red; position: absolute; left: 50%; top: 0%; transform: translate(-50%,-30%);">
                        <div style="width:100%;text-align: center; font-family: pixel; font-size: 80px;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)">
                            <nobr id="scoreR" style="color: deepskyblue; width: 80px">sss</nobr>
                            <nobr style="color:dodgerblue">v</nobr>
                            <nobr style="color:red;">s</nobr>
                            <nobr id="scoreU" style="color:gold;width:80px">sss</nobr>
                        </div>
                    </div>
                    <div style="width: 120px; height: 72px; background: #282828; position: absolute; left: 50%; top: 170px; transform: translate(-50%,-100%); border: 8px solid dodgerblue ">
                        <p id="rbtEmo" style="color:white;text-align:center;font-size:20px">≖＿≖</p>
                        <p id="zzz" style="position: absolute; left:90px; top:-15px;font-size:20px">&#x1F4A4</p>
                    </div>

                    <canvas id="deskCAN" height="500" width="600" style="position:absolute"></canvas>
                    <div style="position:absolute;left:165px;top:170px;transform:translate(0,-100%)">
                        <img id="ImgR" height="50" width="50" src="./aps/question.png"></img>
                    </div>
                    <div style="position:absolute;left:600px;top:300px;transform:translate(-100%,-100%)">
                        <img id="ImgU" height="120" width="120" src="./aps/question.png"></img>
                    </div>
                    <div style="position:absolute;left:50%;top:320px;transform:translate(-50%,0);">
                        <button class="choseBut" id="butn1" onclick="chooseclk(1)"> 石头 </button>
                        <button class="choseBut" id="butn2" onclick="chooseclk(2)"> 剪刀 </button>
                        <button class="choseBut" id="butn3" onclick="chooseclk(3)"> 布 </button>
                        <button id="st" style="border: lime 3px solid; background-color: greenyellow;color:darkgreen" onclick="init()"> 开始 </button>
                    </div>

                    <div style="width: 240px; height: 60px; position: absolute; left: 50%; top: 270px; transform: translate(-50%,-100%); background-color: rgba(255,255,255,0.6); border:4px solid lightskyblue;outline: 4px solid dodgerblue;font-family:pixel;font-size:18px">
                        <p id="rwdnews" style="color:red;margin:0">连击*0</p>       <!--连击-->
                        <p style="margin:0">
                            结果：
                            <nobr id="rst"></nobr>
                        </p>
                    </div>
                </div>

                <div id="newsArea" style="height: 400px; width: 230px; background-color: #1e1e1e; font-family: info">
                    <!--消息-->

                    <div class="lbg3">
                        <p class="lbg4">
                            <nobr>当前是第</nobr>
                            <nobr id="roundNews" style="color:gold">undefined</nobr>回合
                        </p>
                    </div>
                    <div style="color: white; font-size: 20px; font-weight: 600">
                        <div class="lbg1">
                            <p class="lbg2"> <nobr id="select21" onclick="sltClk3()" onmousemove="inSlt(21)" onmouseleave="outSlt(21)">查看规则</nobr></p>
                        </div>
                        <div class="lbg1">
                            <p class="lbg2"> <nobr id="select22" onclick="showInfo()" onmousemove="inSlt(22)" onmouseleave="outSlt(22)">查看对局信息</nobr></p>
                        </div>
                        <div class="lbg1">
                            <p class="lbg2"><nobr id="select23" onclick="isBTMenu()" onmousemove="inSlt(23)" onmouseleave="outSlt(23)">返回主界面</nobr></p>
                        </div>
                    </div>

                    <div id="buyNewsRound" class="newsCaution" style="display:none;">
                        <image id="caution" src="./icon/caution.png">
                            <p>对局已开始，无法购买或取消购买</p>
                    </div>
                    <div id="startNews" class="newsCaution" style="display:none">
                        <image id="caution" src="./icon/caution.png"></image>
                        <p id="startNewsText">请点击开始按钮</p>
                    </div>
                    <div id="costNewsInsufficient" class="newsCaution" style="display:none">
                        <image id="caution" src="./icon/caution.png"></image>
                        <p>余额不足或将无法开启回合</p>
                    </div>
                    <div id="endlessNewsBuy" class="newsCaution" style="display:none">
                        <image id="caution" src="./icon/caution.png"></image>
                        <p>当前回合已购买其他道具</p>
                    </div>

                </div>

                <div id="shopD" style="top:0;width:140px">
                    <!--商店页面-->
                    <table>
                        <tr>
                            <th>
                                <img width="40" src="./icon/coin.png"></img>
                            </th>
                            <th style="width:100px">
                                <b style="font-size:40px;color:gold" id="coinT"></b>
                            </th>
                        </tr>
                        <tr style="background-color:gold;">
                            <td>
                                <img width="40" src="./icon/shop.png"></img>
                            </td>
                            <td>
                                <b style="font-size:30px">商店</b></br>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="shopD" style="top:100px;width:420px;display:flex;flex-direction:row-reverse">
                    <div style="width:240px;">
                        <table id="shopTb" border="1">
                            <tr style="font-size:25px;background-color:gold;color:black;">
                                <th style="width:80px">商品</th>
                                <th style="width:80px;background-color:#1e1e1e;color:gold">价格</th>
                                <th style="width:100px">
                                    <img width="40" src="./icon/shopping.png"></img>
                                </th>
                            </tr>
                            <tr>
                                <td onmouseover="descriptionDis(1)" onmouseleave="descriptionHide()">1</td>
                                <td id="shopCost1">10￥</td>
                                <td>
                                    <button id="butBuy1" onclick="buyclk(1)">购买</button>
                                </td>
                            </tr>
                            <tr>
                                <td onmouseover="descriptionDis(2)" onmouseleave="descriptionHide()">2</td>
                                <td id="shopCost2">10￥</td>
                                <td>
                                    <button id="butBuy2" onclick="buyclk(2)">购买</button>
                                </td>
                            </tr>
                            <tr>
                                <td onmouseover="descriptionDis(3)" onmouseleave="descriptionHide()">3</td>
                                <td id="shopCost3">10￥</td>
                                <td>
                                    <button id="butBuy3" onclick="buyclk(3)">购买</button>
                                </td>
                            </tr>
                            <tr>
                                <td onmouseover="descriptionDis(4)" onmouseleave="descriptionHide()">4</td>
                                <td id="shopCost4">10￥</td>
                                <td>
                                    <button id="butBuy4" onclick="buyclk(4)">购买</button>
                                </td>
                            </tr>
                            <tr>
                                <td onmouseover="descriptionDis(5)" onmouseleave="descriptionHide()">5</td>
                                <td id="shopCost5">10￥</td>
                                <td>
                                    <button id="butBuy5" onclick="buyclk(5)">购买</button>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3" style="padding:0">
                                    <p id="removeNews4" style="color:white">
                                        <nobr id="removeNews1"></nobr>             <!--"被去除的选择是："-->
                                        <nobr id="removeNews2" style="color:red"></nobr>
                                        <nobr id="removeNews3"></nobr>
                                    </p>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div id="desArea" style="width:160px;height:100px;">
                        <div id="desText" style="display: none; border: 2px white solid">
                            <p id="disDesT" style="margin:0"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="alertArea" style="display:none">
                <!--弹窗区域-->
                <!--结束界面-->
                <div id="endBG" class="altGround" style="display:none">
                    <div style="height:100px;color:white;font-size:40px">
                        <nobr><b id="gameOver">游戏结束</b></nobr>
                    </div>
                    <div>
                        <button style="background-color:white;border-radius:0;" onclick="endClkRe()">再来一把</button>
                        <button style="background-color:white;border-radius:0;" onclick="showInfo()">检查对局</button>
                        <button style="background-color:white;border-radius:0;" onclick="backToMenu()">回主界面</button>
                    </div>
                </div>
                <!--返回主界面-->
                <div id="BTmenu" class="altGround" style="display:none">
                    <div style="height:100px;color:white;font-size:40px">
                        <nobr><b>是否返回主界面</b></nobr>
                    </div>
                    <div>
                        <button style="background-color:white;border-radius:0;" onclick="backToMenu()">是</button>
                        <button style="background-color:white;border-radius:0;" onclick="noBTmenu()">否</button>
                    </div>
                </div>
                <!--信息表-->
                <div id="infoArea" class="infoBG" style="display:none">
                    <table id="infoTb" border="1" style="width:630px;">
                        <caption style="font-size:30px;font-weight:600">对局信息</caption>
                        <tr style="height:30px">
                            <td>总次数</td>
                            <td>连击</td>
                            <td>最大连击</td>
                            <td>获胜次数</td>
                            <td>平局次数</td>
                            <td>失败次数</td>
                            <td style="width:100px">胜率</td>
                        </tr>
                        <tr style="height:30px">
                            <td id="info1">
                            <td id="info2">
                            <td id="info3">
                            <td id="info4">
                            <td id="info5">
                            <td id="info6">
                            <td id="info7"></td>
                        </tr>

                    </table>
                    <div style="background:#1e1e1e;height:330px;width:100%;position:absolute;left:50%;top:100%;transform:translate(-50%,-100%)">
                        <table>
                            <tr>
                                <td style="color:white;font-size:25px">电脑的选择</td>
                                <td style="width:30px;background-color:deepskyblue"></td>
                                <td style="width:100px"></td>
                                <td style="color:white;font-size:25px">你的选择</td>
                                <td style="width:30px;background-color:gold"></td>
                            <tr>
                        </table>
                        <div style="display:flex;">
                            <div>
                                <table class="roundRstTb" border="1" style="border-color:deepskyblue;color:white">
                                    <tr style="position:sticky;left:0">
                                        <td>回合</td>
                                        <td>石头</td>
                                        <td>剪刀</td>
                                        <td>布</td>
                                    </tr>
                                </table>
                                <table class="roundRstTb" border="1" style="border-color:gold;color:white">
                                    <tr>
                                        <td>石头</td>
                                        <td>剪刀</td>
                                        <td>布</td>
                                        <td>结果</td>
                                    </tr>
                                </table>
                            </div>
                            <div style="width:590px;overflow:auto">
                                <table id="RstTb1" class="roundRstTb" border="1" style="border-color:deepskyblue;width:0">
                                    <tr style="color:white">
                                        <td>0</td>
                                        <td>\</td>
                                        <td>\</td>
                                        <td>\</td>
                                    </tr>
                                </table>
                                <table id="RstTb2" class="roundRstTb" border="1" style="border-color:gold;width:0">
                                    <tr style="color:white">
                                        <td>\</td>
                                        <td>\</td>
                                        <td>\</td>
                                        <td>\</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <button onclick="backToGame()" style="border:2px deepskyblue solid; border-radius:0;background-color:#1e1e1e;color:white;position:absolute;left:100%;top:0;transform:translate(-100%,0)">返回</button>
                </div>
                <div id="historyArea" style="background-color:#1e1e1e;width:100%;height:100%;overflow-y:auto;">
                    <button onclick="backToMenu()" style="border-radius:0">退出</button>
                    <p id="rr" style="color:deepskyblue;font-family:info;font-size:30px;"></p>
                    <table id="hisTb" border="1" style="width:100%;border-color: deepskyblue; color: deepskyblue;font-family:info;font-size:20px;display:none">
                        <tr style="position:sticky;top:0;background-color:#1e1e1e"><!--首行冻结-->
                            <td>时间</td>
                            <td>模式</td>
                            <td>对局结果</td>
                            <td>回合数</td>
                            <td>最大连击</td>
                            <td>获胜次数</td>
                            <td>平局次数</td>
                            <td>失败次数</td>
                            <td>胜率</td>
                            <td>结算时金币</td>
                        </tr>
                    </table>
                </div>
                <!--主框架-->
            </div>
        </div>
    </div>
    <!--主框架-->
</body>
</html>
<script>
    function setId(id) {
        var id = document.getElementById('"' + id + '"');
    }
  
    //----数组
    var imgRps = new Array();
    imgRps[0] = "./aps/ani.gif";
    imgRps[1] = "./aps/rock.png";
    imgRps[2] = "./aps/scissors.png";
    imgRps[3] = "./aps/paper.png";
    imgRps[4] = "./aps/question.png";

    var isWin = new Array();
    isWin[0] = null;

    var chooseAll = new Array();
    chooseAll[0] = null;
    chooseAll[1] = "石头";
    chooseAll[2] = "剪刀";
    chooseAll[3] = "布";

    var Start = "开始";
    var idrst = document.getElementById("rst");
    var butn1 = document.getElementById("butn1");
    var butn2 = document.getElementById("butn2");
    var butn3 = document.getElementById("butn3");
    var st = document.getElementById("st");
    var rwdnews = document.getElementById("rwdnews");
    var ImgR = document.getElementById("ImgR");
    var ImgU = document.getElementById("ImgU");
    var coinT = document.getElementById("coinT");
    var desText = document.getElementById("desText");
    var desArea = document.getElementById("desArea");
    var disDesT = document.getElementById("disDesT");
    var gameArea = document.getElementById("gameArea");
    var main = document.getElementById("main");
    var rbtEmo = document.getElementById("rbtEmo");
    var zzz = document.getElementById("zzz");

    var deskCAN = document.getElementById("deskCAN");

    var winRst = 0;
    var chooseR;
    var ischoose = true;
    var chooseU = 0;
    var Pcoin = 0;//金币变化量
    var coinP = 1;//变化量倍率
    var comboIs;//通过输赢判断的是否连击 1增加，2减少，3不变
    var skipCombo = false//是否不中断连击
    var removeChsR = false;//是否去除电脑的一个选择
    var removeN;//被去掉的值
    var IsPlaying = false;
    var isClkStart = false;
    var SvR;

    var RstTb1 = document.getElementById("RstTb1");
    var RstTb2 = document.getElementById("RstTb2");
    var infoArea = document.getElementById("infoArea");
    var scoreR = document.getElementById("scoreR");
    var scoreU = document.getElementById("scoreU");
    var gameOver = document.getElementById("gameOver");
    var BTmenu = document.getElementById("BTmenu");
    var roundEnd;                           //信息相关
    var times = 0;
    var winN = 0;
    var loseN = 0;
    var drawN = 0;
    var coinN = 100;
    var winRate = 0;
    var comboN = 0;
    var comboMax = 0;
    var infoRst = new Array();
    infoRst[0] = null;
    infoRst[1] = "赢";
    infoRst[2] = "平";
    infoRst[3] = "输";

    var lessCoin;                           //商店相关
    var isBuy = new Array();
    isBuy[0] = null;

    var textDes = new Array();
    textDes[0] = null;
    textDes[1] = "下回合不会中断连击";
    textDes[2] = "去掉电脑一个选择";
    textDes[3] = "下回合金币增加/减少数量翻倍";
    textDes[4] = "无效果";
    textDes[5] = "无效果";

    var cost = new Array();
    cost[0] = null;
    cost[1] = 5;
    cost[2] = 5;
    cost[3] = 10;
    cost[4] = 20;
    cost[5] = 30;

    var canBuy = true;
    var endlessBuy = false;
    var normalMode;
    var isStart = false;

    var removeNews1 = document.getElementById("removeNews1"); //消息相关
    var removeNews2 = document.getElementById("removeNews2");
    var removeNews3 = document.getElementById("removeNews3");
    var removeNews4 = document.getElementById("removeNews4");
    var roundNews = document.getElementById("roundNews");
    var buyNewsRound = document.getElementById("buyNewsRound");
    var costNewsInsufficient = document.getElementById("costNewsInsufficient");
    var endlessNewsBuy = document.getElementById("endlessNewsBuy");
    var startNews = document.getElementById("startNews");
    var startNewsText = document.getElementById("startNewsText");
    var newsArea = document.getElementById("newsArea");

    var mainFrame = document.getElementById("mainFrame");    //主界面相关
    var naDivg = document.getElementById("naDivg");
    var naCanvas = document.getElementById("naCanvas");
    var ruleArea = document.getElementById("ruleArea");
    var menuArea = document.getElementById("menuArea");
    var mianBG = document.getElementById("mainBG");
    //弹窗相关
    var endBG = document.getElementById("endBG");
    var alertArea = document.getElementById("alertArea");
    //
    var historyArea = document.getElementById("historyArea");//历史记录相关
    var hisTb = document.getElementById("hisTb");
    var rr = document.getElementById("rr");
    //---------------------------------------------------------------------------------
    function onload() {           										 //载入页面
        deskBG();
        canvasBg()
        btcolor(1);
        for (var i = 1; i <= 7; i++) { //获取信息表id
            setId("info" + i);
        }
        check();
        for (var i = 1; i <= 5; i++) {
            isBuy[i] = false;
        }
		if (isMobile()) {
			var lh=document.documentElement.clientHeight/2000;
			var lw=document.documentElement.clientWidth/1000;
			var lz=(lh<lw?lh:lw);
			document.getElementById("bd").style.transform="rotateZ(90deg) scale("+lz.toFixed(1)+")";
		}
    }

    function reAni(obj, ani) {								//再次播放某动画
        obj.style.display = "";
        obj.classList.remove(ani);
        void obj.offsetWidth;
        obj.classList.add(ani);
        obj.style.animationPlayState = "running";
        obj.style.WebkitAnimationPlayState = "running"
    }
    function gameToGray() {
        gameArea.style.animationDirection = "normal";     //正向播放动画
        reAni(gameArea, "gray");
    }
    function gameToColor() {
        gameArea.style.animationDirection = "reverse";   //反向播放动画
        reAni(gameArea, "gray");
    }

    function btcolor(x) {
        let color1;
        let color2;
        if (x) {
            butn1.style.filter = "grayscale(100%)";
            butn2.style.filter = "grayscale(100%)";
            butn3.style.filter = "grayscale(100%)";
            st.style.filter = "";
        } else {
            butn1.style.filter = "";
            butn2.style.filter = "";
            butn3.style.filter = "";
            st.style.filter = "grayscale(100%)";

        }
    }
    //    开始/继续 按钮
    function init() {
        if (!isClkStart) {
            if (!isStart) {
                Start = "继续";
                st.innerText = Start;
                rbtEmo.innerText = "ΦωΦ";
                zzz.style.display = "none";
            } else {
                isStart = true;
            }
            ischoose = false;
            ImgR.src = imgRps[0];
            ImgU.src = imgRps[0];
            btcolor(0);

            canBuy = false;
            coinN -= lessCoin;
            check();
            isClkStart = true;
        }
    }
    // 流程
    function tapStart() {
        setChsR();
        showRs(true);							//显示问号图片
        setTimeout("showRs(false)", 200);
        compare();
        setTlement();
        btcolor(1);
        check();
    }

    function chooseclk(x) {
        if (ischoose) {
            reAni(startNews, "disappear");
            startNewsText.innerText = "请点击" + Start + "按钮";
        } else {
            chooseU = x;
            tapStart();
        }
    }

    function setChsR() {
        if (removeChsR) {
            chooseR = randomNum(1, 3);
            while (chooseR == removeN) {
                chooseR = randomNum(1, 3);
            }
        } else {
            chooseR = randomNum(1, 3);
        }
    }

    //比较
    function compare() {
        if (chooseU == 1 && chooseR == 3) { winRst = 3; loseN++; }
        if (chooseU == 3 && chooseR == 1) { winRst = 1; winN++; }
        if (winRst == 0) {
            if (chooseU == chooseR) { winRst = 2; drawN++ }
            if (chooseU > chooseR) { winRst = 3; loseN++ }
            if (chooseU < chooseR) { winRst = 1; winN++ }
        }
    }

    function iswinF() {
        if (winRst == 1) {
            Pcoin += 10;
            comboIs = 1;
            coinN += lessCoin;      //返还成本
            idrst.style.color = "blue";
        } else {     
            if (winRst == 2) {
                comboIs = 3;
                idrst.style.color = "green";
            } else {
                Pcoin -= 10;
                comboIs = 2;
                idrst.style.color = "red";
            }
        }
    }
    function iscomboF() {
        
        if (!skipcombo && comboIs == 2) {
            comboN = 0;
        } else if (comboIs == 1) {
            comboN++;
        }
        if (comboN >= comboMax) { comboMax = comboN; }
        if (comboN >= 1) {
            
        }
        rwdnews.innerText = "连击*" + comboN;
    }

    function reward() {
        if (comboIs == 1) {
            if (comboN >= 6) {
                rwdnews.innerText = rwdnews.innerText + "，额外获50金币";
                Pcoin += 50;
            } else {
                switch (comboN) {
                    case 3:
                        rwdnews.innerText = rwdnews.innerText + "，额外获得10金币";
                        Pcoin += 10;
                        break;
                    case 4:
                        rwdnews.innerText = rwdnews.innerText + "，额外获得20金币";
                        Pcoin += 20;
                        break;
                    case 5:
                        rwdnews.innerText = rwdnews.innerText + "，额外获得30金币";
                        Pcoin += 30;
                        break;
                }
            }
        }
    }

    function showRs(x) {
        if (x) {
            ImgR.src = imgRps[4];
            ImgU.src = imgRps[4];
        } else {
            ImgR.src = imgRps[chooseR];
            ImgU.src = imgRps[chooseU];
        }
    }

    function buyclk(x) {
        if (!canBuy) {
            reAni(buyNewsRound, "disappear");
        } else {
            let a = document.getElementById('butBuy' + x);
            if (isBuy[x]) {
                isBuy[x] = false;						//取消购买
                endlessBuy = false;
                switch (x) {
                    case 1:
                        skipcombo = false;
                        break;
                    case 2:
                        removeNews4.style.display = "none";
                        removeChsR = false;
                        break;
                    case 3:
                        coinP = 1;
                        break;
                    case 4:
                        break;
                    case 5:
                        break;
                }
                a.innerText = "购买";
                a.style.color = "blue";
                coinN += cost[x];
            } else if (coinN - cost[x] < lessCoin) {
                reAni(costNewsInsufficient, "disappear");    //钱不够
            } else if (endlessBuy) {
                reAni(endlessNewsBuy, "disappear");
            } else {
                isBuy[x] = true;
                if (!normalMode) {
                    endlessBuy = true;
                }
                switch (x) {
                    //购买
                    case 1:
                        skipcombo = true;
                        break;
                    case 2:
                        removeNews4.style.display = "";
                        removeNews1.innerText = "已将电脑的选择";
                        removeNews2.innerText = chooseAll[removeN];
                        removeNews3.innerText = "去除";
                        removeChsR = true;
                        break;
                    case 3:
                        coinP = 2;
                        break;
                    case 4:
                        break;
                    case 5:
                        break;
                }
                a.innerText = "已购买";
                a.style.color = "gray";
                coinN -= cost[x];
            }
            check();

        }
    }

    function descriptionDis(x) { 								//显示物品介绍文本
        desText.style.display = "";
        disDesT.innerText = textDes[x];
        desText.style.top = (x* 43) + "px";
    }

    function descriptionHide() {
        desText.style.display = "none";
    }

    //计算胜率
    function mathWin() {
        if (times > 0) {
            let a = winN * 100 / times;
            winRate = a.toFixed(1) + "%";
        } else {
            winRate = "无";
        }
    }

    function setTlement() {                                         //结算
        iswinF();
        iscomboF();
        reward();

        isWin[1] = "回合胜利，赢得" + (coinP * Pcoin) + "金币"; //显示结果
        isWin[2] = "平局";
        isWin[3] = "回合失败，输掉" + (-coinP * Pcoin) + "金币";
        idrst.innerText = isWin[winRst];

        times++;									//处理结果
        coinN = Pcoin * coinP + coinN;
        if (winRst == 3) {
            rbtEmo.innerText = "=￣ω￣=";
        } else if (winRst == 2) {
            rbtEmo.innerText = "￣△￣";
        } else {
            rbtEmo.innerText = "｀へ´ ";
        }

        setRoundInfo();
        roundInit();
        end();
    }
    function roundInit() {
        winRst = 0;									//回合初始化
        Pcoin = 0;
        ischoose = true;
        coinP = 1;
        canBuy = true;
        skipcombo = false;
        removeChsR = false;
        endlessBuy = false;
        isClkStart = false;

        removeN = randomNum(1, 3)
        for (var i = 1; i <= 5; i++) {							//重置购买键
            let a = document.getElementById('butBuy' + i);
            a.innerText = "购买";
            a.style.color = "blue";
            isBuy[i] = false;
            removeNews4.style.display = "none";
        }
    }
    function alertOff() {
        alertArea.style.display = "none";                       //关闭弹窗
        endBG.style.display = "none";
        infoArea.style.display = "none";
        BTmenu.style.display = "none";
        historyArea.style.display = "none";
    }
    function end() {                                             //判断结束
        if (normalMode) {
            if (winN == 10) {
                SvR = "获胜";
                gameOver.innerText = "获胜";
                alertArea.style.display = "";
                endBG.style.display = "";
                IsPlaying = false;
                gameToGray();
                saveData();
            } else if (loseN == 10 || coinN < lessCoin) {
                SvR = "失败";
                gameOver.innerText = "失败";
                alertArea.style.display = "";
                endBG.style.display = "";
                IsPlaying = false;
                gameToGray();
                saveData();
            }
        } else if (coinN < lessCoin) {
            SvR = "无";
            gameOver.innerText = "游戏结束";
            alertArea.style.display = "";
            endBG.style.display = "";
            IsPlaying = false;
            gameToGray();
            saveData();
        }
    }
    function check() {
        mathWin();
        roundNews.innerText = times + 1;
        info1.innerText = times;
        info2.innerText = comboN;
        info3.innerText = comboMax;
        info4.innerText = winN;
        info5.innerText = drawN;
        info6.innerText = loseN;
        info7.innerText = winRate;
        coinT.innerText = ":" + coinN;
        scoreR.innerText = loseN;
        scoreU.innerText = winN;
        for (var i = 1; i <= 5; i++) {
            let a = document.getElementById('shopCost' + i);
            a.innerText = cost[i] + "￥";
        }

    }
    function setRoundInfo() {                                  //动态添加表格内容，记录每局信息
        RstTb1.style.width = (times + 1) * 54 + 2 + "px";
        let rowNew1 = RstTb1.insertRow();
        let ra1 = rowNew1.insertCell();
        let rb1 = rowNew1.insertCell();
        let rc1 = rowNew1.insertCell();
        let rd1 = rowNew1.insertCell();
        RstTb2.style.width = (times + 1) * 54 + 2 + "px";
        let rowNew2 = RstTb2.insertRow();
        let ra2 = rowNew2.insertCell();
        let rb2 = rowNew2.insertCell();
        let rc2 = rowNew2.insertCell();
        let rd2 = rowNew2.insertCell();
        ra1.innerText = times;
        ra1.style.color = "white";
        rd2.innerText = infoRst[winRst];
        rd2.style.color = "white";

        switch (winRst) {
            case 1:
                rd2.style.backgroundColor = "blue";
                break;
            case 2:
                rd2.style.backgroundColor = "green";
                break;
            case 3:
                rd2.style.backgroundColor = "red";
                break;
        }

        switch (chooseR) {
            case 1:
                rb1.style.backgroundColor = "deepskyblue";
                break;
            case 2:
                rc1.style.backgroundColor = "deepskyblue";
                break;
            case 3:
                rd1.style.backgroundColor = "deepskyblue";
                break;
        }
        switch (chooseU) {
            case 1:
                ra2.style.backgroundColor = "gold";
                break;
            case 2:
                rb2.style.backgroundColor = "gold";
                break;
            case 3:
                rc2.style.backgroundColor = "gold";
                break;
        }
    }
    function clearTable(x) {                           //清空表格数据
        let rowCount = x.rows.length;
        for (var i = rowCount - 1; i > 0; i--) {
            x.deleteRow(i);
        }
    }
    //生成从minNum到maxNum的随机数
    function randomNum(minNum, maxNum) {
        switch (arguments.length) {
            case 1:
                return parseInt(Math.random() * minNum + 1, 10);
                break;
            case 2:
                return parseInt(Math.random() * (maxNum - minNum + 1) + minNum, 10);
                break;
            default:
                return 0;
                break;
        }
    }
    function showInfo() {
        alertOff();
        alertArea.style.display = "";
        infoArea.style.display = "";                                          //查看信息表
        if (IsPlaying) {
            gameToGray();
        }
    }
    function backToGame() {
        if (IsPlaying) {
            alertOff();
            gameToColor();
        } else {
            alertOff();
            alertArea.style.display = "";
            endBG.style.display = "";
        }
    }
    function inSlt(x) {
        let a = document.getElementById("select" + x);
        a.style.color = "red";
    }
    function outSlt(x) {
        let a = document.getElementById("select" + x);
        a.style.color = "white";
    }
    function endClkRe() {              //再来一把
        if (normalMode) {
            sltClk1();
        } else {
            sltClk2();
        }
    }
    function backToMenu() {           //回主界面
        alertOff();
        gameArea.style.display = "none";
        menuArea.style.display = "";
        IsPlaying = false;
    }
    function sltClk1() {               //普通模式
        normalMode = true;
        coinN = 100;
        lessCoin = 5;
        roundEnd = 20;
        modeInit();
    }

    function sltClk2() {				//无尽模式
        normalMode = false;
        coinN = 200;
        lessCoin = 10;
        roundEnd = -1;
        modeInit();
    }
    function sltClk3() {				//查看游戏规则
        if (IsPlaying) {
            gameArea.style.display = "none";
        } else {
            menuArea.style.display = "none";
        }
        ruleArea.style.display = "";
    }
    function rulesClkBack() {
        ruleArea.style.display = "none";
        if (IsPlaying) {
            gameArea.style.display = "";
        } else {
            menuArea.style.display = "";
        }
    }
    function isBTMenu() {
        gameToGray();
        alertArea.style.display = "";
        BTmenu.style.display = "";
    }
    function noBTmenu() {
        alertOff();
        gameToColor();
    }
    function modeInit() {                       //重置模式数据
        Start = "开始";               //处理按下“开始/继续”键后直接回主界面
        showRs(true);
        btcolor(1);
        isStart = false;
        clearTable(RstTb1);           //重置信息表
        RstTb1.style.width = "0";
        clearTable(RstTb2);         //重置回合表
        RstTb2.style.width = "0";
        alertOff();
        gameToColor();
        rbtEmo.innerText = "≖＿≖";
        zzz.style.display = "";
        st.innerText = Start;
        IsPlaying = true;
        menuArea.style.display = "none";
        gameArea.style.display = "";
        rwdnews.innerText = "连击*0";
        times = 0;
        winN = 0;
        loseN = 0;
        drawN = 0;
        winRate = 0;
        comboN = 0;
        comboMax = 0;
        idrst.innerText = "";
        buyNewsRound.style.display = "none";
        startNews.style.display = "none";
        costNewsInsufficient.style.display = "none";
        endlessNewsBuy.style.display = "none";
        roundInit();
        check();
    }

    function canvasBg() {
        let ctx = naCanvas.getContext("2d");
        ctx.fillStyle = "purple";
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(1400, 0);
        ctx.lineTo(0, 700);
        ctx.fill();
    }
    function deskBG() {
        let ctx = deskCAN.getContext("2d");
        ctx.fillStyle = "lime";                         //桌面
        ctx.beginPath();
        ctx.moveTo(0, 300);
        ctx.lineTo(600, 300);
        ctx.lineTo(440, 170);
        ctx.lineTo(160, 170);
        ctx.fill();
        ctx.globalCompositeOperation = "xor";          //画布叠加
        ctx.fillStyle = "darkGreen";
        ctx.beginPath();                              //底座       
        ctx.moveTo(160, 280);
        ctx.lineTo(440, 280);
        ctx.lineTo(425, 260);
        ctx.lineTo(175, 260);
        ctx.fill();
        ctx.globalCompositeOperation = "xor";
        ctx.fillStyle = "limeGreen";
        ctx.fillRect(0, 300, 600, 20);
        ctx.fillStyle = "limeGreen";                //桌子腿
        ctx.fillRect(0, 320, 25, 150);
        ctx.fillStyle = "darkGreen";
        ctx.beginPath();
        ctx.moveTo(25, 320);
        ctx.lineTo(25, 470);
        ctx.lineTo(45, 440);
        ctx.lineTo(45, 320);
        ctx.fill();
        ctx.fillStyle = "limeGreen";
        ctx.fillRect(575, 320, 25, 150);
        ctx.fillStyle = "darkGreen";
        ctx.beginPath();
        ctx.moveTo(575, 320);
        ctx.lineTo(575, 470);
        ctx.lineTo(555, 440);
        ctx.lineTo(555, 320);
        ctx.fill();
    }

    function saveData() {                                   //保存记录
        check();
        if (!localStorage.id) {
            localStorage.setItem("id", "1");//初始化id
            var iid = 1;
        } else {
            var iid = localStorage.getItem("id");
            iid++;
            localStorage.setItem("id",iid);
        }
        var dt = new Date();
        var ti = dt.toLocaleString(); 
        localStorage.setItem("saveTime" + iid, ti);//保存时间
        if (normalMode) {
            var SvM = "普通";
        } else {
            var SvM = "无尽";
        }
        localStorage.setItem("saveMode" + iid, SvM);//模式信息
        localStorage.setItem("saveResult" + iid,SvR);//结果
        localStorage.setItem("saveRound" + iid, times);//回合数
        localStorage.setItem("saveWin" + iid, winN);//获胜次数
        localStorage.setItem("saveDraw" + iid, drawN);//平局次数
        localStorage.setItem("saveLose" + iid, loseN);//失败次数
        localStorage.setItem("saveMaxCombo" + iid, comboMax);//最大连击
        localStorage.setItem("saveWinRate" + iid,winRate);//胜率
        localStorage.setItem("saveCoin" + iid,coinN);//结算金币
    }
    function showHis() {                 //显示历史记录
        alertOff();  
        clearTable(hisTb);
        if (localStorage.id) {
            rr.innerText = "";
            hisTb.style.display = "";
            var sid = Number(localStorage.id);
            for (var i = 1; i <= sid; i++) {
                var rowNew = hisTb.insertRow();
                var t1 = rowNew.insertCell();
                var t2 = rowNew.insertCell();
                var t3 = rowNew.insertCell();
                var t4 = rowNew.insertCell();
                var t5 = rowNew.insertCell();
                var t6 = rowNew.insertCell();
                var t7 = rowNew.insertCell();
                var t8 = rowNew.insertCell();
                var t9 = rowNew.insertCell();
                var t10 = rowNew.insertCell();
                t1.innerText = localStorage.getItem("saveTime" + i);
                t2.innerText = localStorage.getItem("saveMode" + i);
                t3.innerText = localStorage.getItem("saveResult" + i);
                t4.innerText = localStorage.getItem("saveRound" + i);
                t5.innerText = localStorage.getItem("saveMaxCombo" + i);
                t6.innerText = localStorage.getItem("saveWin" + i);
                t7.innerText = localStorage.getItem("saveDraw" + i);
                t8.innerText = localStorage.getItem("saveLose" + i);
                t9.innerText = localStorage.getItem("saveWinRate" + i);
                t10.innerText = localStorage.getItem("saveCoin" + i);
            }
        } else {
            hisTb.style.display = "none";
            rr.innerText = "还没有历史数据，试着来一局？";
        }
        alertArea.style.display = "";
        historyArea.style.display = "";
    }
	function isMobile() {
    const userAgentInfo = navigator.userAgent;
    const mobileAgents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
     const mobileFlag = mobileAgents.some((mobileAgent) => {
        return userAgentInfo.indexOf(mobileAgent) > 0;
    });
    return mobileFlag;
}
</script>